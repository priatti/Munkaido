<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Munkaidő Nyilvántartó Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="./style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <div id="loader" class="loader-container">
        <div class="loader"></div>
        <p>Betöltés...</p>
    </div>

    <div id="auth-container">
        <img src="./assets/logo.png" alt="Logo" class="auth-logo">
        <div class="auth-form">
            <h2>Bejelentkezés / Regisztráció</h2>
            <input type="email" id="auth-email" placeholder="Email" required>
            <input type="password" id="auth-password" placeholder="Jelszó" required>
            <button id="login-button" class="btn primary">Bejelentkezés</button>
            <button id="register-button" class="btn secondary">Regisztráció</button>
            <p class="error-message" id="auth-error-message"></p>
        </div>
    </div>

    <div id="app-container" style="display:none;">
        <header>
            <div class="header-left">
                <img src="./assets/logo.png" alt="Logo" class="header-logo">
                <nav>
                    <button class="nav-button active" id="nav-entry">Bejegyzés</button>
                    <button class="nav-button" id="nav-records">Előzmények</button>
                    <button class="nav-button" id="nav-statistics">Statisztika</button>
                    <button class="nav-button" id="nav-pallet">Raklap</button>
                    <button class="nav-button" id="nav-tachograph">Tachográf</button>
                </nav>
            </div>
            <div class="header-right">
                <span id="user-display" class="user-display"></span>
                <div class="language-selector">
                    <button id="lang-hu" class="lang-button active">HU</button>
                    <button id="lang-de" class="lang-button">DE</button>
                    <button id="lang-en" class="lang-button">EN</button>
                </div>
                <button id="logout-button" class="btn logout"><i class="fas fa-sign-out-alt"></i></button>
            </div>
        </header>

        <main>
            <section id="entry-view" class="content-section active">
                <h2>Új bejegyzés</h2>
                <div class="form-group">
                    <label for="date">Dátum:</label>
                    <input type="date" id="date" class="input-field">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="startTime">Kezdet:</label>
                        <input type="time" id="startTime" class="input-field">
                    </div>
                    <div class="form-group">
                        <label for="endTime">Vég:</label>
                        <input type="time" id="endTime" class="input-field">
                    </div>
                    <div class="form-group">
                        <label for="breakTime">Szünet (perc):</label>
                        <input type="number" id="breakTime" class="input-field" value="0" min="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="kmStart">Km kezdet:</label>
                        <input type="number" id="kmStart" class="input-field" value="0" min="0">
                    </div>
                    <div class="form-group">
                        <label for="kmEnd">Km vég:</label>
                        <input type="number" id="kmEnd" class="input-field" value="0" min="0">
                    </div>
                </div>
                <div class="form-group">
                    <label for="route">Útvonal:</label>
                    <input type="text" id="route" class="input-field">
                </div>
                <div class="form-group">
                    <label for="notes">Megjegyzés:</label>
                    <textarea id="notes" class="input-field"></textarea>
                </div>
                <div class="form-group location-group">
                    <button id="getLocation" class="btn secondary small"><i class="fas fa-map-marker-alt"></i> Helyzet lekérése</button>
                    <span id="currentLocation" class="location-text"></span>
                </div>
                <button id="saveEntry" class="btn primary">Bejegyzés mentése</button>
                <button id="discardShift" class="btn danger">Műszak elvetése</button>
                <p class="error-message" id="entry-error-message"></p>
            </section>

            <section id="records-view" class="content-section">
                <h2>Előzmények</h2>
                <div class="filter-controls">
                    <label for="month-filter">Hónap:</label>
                    <input type="month" id="month-filter" class="input-field filter-field">
                    <label for="year-filter">Év:</label>
                    <input type="number" id="year-filter" class="input-field filter-field" min="2000" max="2100">
                    <button id="apply-filter" class="btn secondary small">Szűrés</button>
                    <button id="clear-filter" class="btn secondary small">Szűrő törlése</button>
                </div>
                <div class="records-list-container">
                    <table class="records-table">
                        <thead>
                            <tr>
                                <th>Dátum</th>
                                <th>Kezd.</th>
                                <th>Vég</th>
                                <th>Szünet</th>
                                <th>Vez.idő</th>
                                <th>Km</th>
                                <th>Útvonal</th>
                                <th>Műveletek</th>
                            </tr>
                        </thead>
                        <tbody id="records-list">
                            </tbody>
                    </table>
                </div>
                <div class="summary-cards">
                    <div class="card summary-card">
                        <h3>Összes vezetési idő</h3>
                        <p id="total-drive-time">0 óra 0 perc</p>
                    </div>
                    <div class="card summary-card">
                        <h3>Összes megtett km</h3>
                        <p id="total-km">0 km</p>
                    </div>
                </div>
                <div class="action-buttons">
                    <button id="exportPdf" class="btn primary"><i class="fas fa-file-pdf"></i> PDF exportálás</button>
                    <button id="sharePdf" class="btn secondary"><i class="fas fa-share-alt"></i> PDF megosztása</button>
                    <button id="importData" class="btn secondary"><i class="fas fa-file-import"></i> Adatok importálása</button>
                    <input type="file" id="importFileInput" accept=".json" style="display: none;">
                </div>
            </section>

            <section id="statistics-view" class="content-section">
                <h2>Statisztika</h2>
                <div class="chart-controls">
                    <label for="stats-year-filter">Év:</label>
                    <input type="number" id="stats-year-filter" class="input-field filter-field" min="2000" max="2100">
                    <button id="apply-stats-filter" class="btn secondary small">Szűrés</button>
                </div>
                <div class="chart-container">
                    <canvas id="monthlyDriveTimeChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="monthlyKmChart"></canvas>
                </div>
            </section>

            <section id="pallet-view" class="content-section">
                <h2>Raklap nyilvántartás</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="palletDate">Dátum:</label>
                        <input type="date" id="palletDate" class="input-field">
                    </div>
                    <div class="form-group">
                        <label for="palletCount">Raklap darabszám:</label>
                        <input type="number" id="palletCount" class="input-field" value="0" min="0">
                    </div>
                </div>
                <div class="form-group">
                    <label for="palletNotes">Megjegyzés:</label>
                    <textarea id="palletNotes" class="input-field"></textarea>
                </div>
                <button id="savePalletEntry" class="btn primary">Raklap bejegyzés mentése</button>
                <p class="error-message" id="pallet-error-message"></p>

                <h3>Raklap előzmények</h3>
                <div class="filter-controls">
                    <label for="pallet-month-filter">Hónap:</label>
                    <input type="month" id="pallet-month-filter" class="input-field filter-field">
                    <label for="pallet-year-filter">Év:</label>
                    <input type="number" id="pallet-year-filter" class="input-field filter-field" min="2000" max="2100">
                    <button id="apply-pallet-filter" class="btn secondary small">Szűrés</button>
                    <button id="clear-pallet-filter" class="btn secondary small">Szűrő törlése</button>
                </div>
                <div class="records-list-container">
                    <table class="records-table">
                        <thead>
                            <tr>
                                <th>Dátum</th>
                                <th>Darabszám</th>
                                <th>Megjegyzés</th>
                                <th>Műveletek</th>
                            </tr>
                        </thead>
                        <tbody id="pallet-records-list">
                            </tbody>
                    </table>
                </div>
                <div class="summary-cards">
                    <div class="card summary-card">
                        <h3>Összes raklap</h3>
                        <p id="total-pallets">0 db</p>
                    </div>
                </div>
            </section>

            <section id="tachograph-view" class="content-section">
                <h2>Tachográf elemzés</h2>

                <div class="form-group toggle-group">
                    <label class="toggle-switch">
                        <input type="checkbox" id="toggleSplitRest" class="sr-only toggle-label">
                        <span class="slider round"></span>
                    </label>
                    <span class="toggle-text" id="labelSplitRest">Osztott pihenő (3+9 óra)</span>
                </div>

                <div class="form-group toggle-group">
                    <label class="toggle-switch">
                        <input type="checkbox" id="toggleWeeklyRest" class="sr-only toggle-label">
                        <span class="slider round"></span>
                    </label>
                    <span class="toggle-text" id="labelWeeklyRest">Heti pihenő </span>
                </div>

                <div class="info-box">
                    <p id="tachograph-info"></p>
                </div>
            </section>
        </main>
    </div>

    <div id="editRecordModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeEditRecordModal">&times;</span>
            <h2>Bejegyzés szerkesztése</h2>
            <input type="hidden" id="editRecordId">
            <div class="form-group">
                <label for="editDate">Dátum:</label>
                <input type="date" id="editDate" class="input-field">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="editStartTime">Kezdet:</label>
                    <input type="time" id="editStartTime" class="input-field">
                </div>
                <div class="form-group">
                    <label for="editEndTime">Vég:</label>
                    <input type="time" id="editEndTime" class="input-field">
                </div>
                <div class="form-group">
                    <label for="editBreakTime">Szünet (perc):</label>
                    <input type="number" id="editBreakTime" class="input-field" value="0" min="0">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="editKmStart">Km kezdet:</label>
                    <input type="number" id="editKmStart" class="input-field" value="0" min="0">
                </div>
                <div class="form-group">
                    <label for="editKmEnd">Km vég:</label>
                    <input type="number" id="editKmEnd" class="input-field" value="0" min="0">
                </div>
            </div>
            <div class="form-group">
                <label for="editRoute">Útvonal:</label>
                <input type="text" id="editRoute" class="input-field">
            </div>
            <div class="form-group">
                <label for="editNotes">Megjegyzés:</label>
                <textarea id="editNotes" class="input-field"></textarea>
            </div>
            <button id="saveEditedRecord" class="btn primary">Módosítások mentése</button>
            <p class="error-message" id="edit-record-error-message"></p>
        </div>
    </div>

    <div id="editPalletModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeEditPalletModal">&times;</span>
            <h2>Raklap bejegyzés szerkesztése</h2>
            <input type="hidden" id="editPalletId">
            <div class="form-group">
                <label for="editPalletDate">Dátum:</label>
                <input type="date" id="editPalletDate" class="input-field">
            </div>
            <div class="form-group">
                <label for="editPalletCount">Darabszám:</label>
                <input type="number" id="editPalletCount" class="input-field" min="0">
            </div>
            <div class="form-group">
                <label for="editPalletNotes">Megjegyzés:</label>
                <textarea id="editPalletNotes" class="input-field"></textarea>
            </div>
            <button id="saveEditedPallet" class="btn primary">Módosítások mentése</button>
            <p class="error-message" id="edit-pallet-error-message"></p>
        </div>
    </div>

    <div id="customAlertModal" class="modal">
        <div class="modal-content custom-alert-content">
            <span class="close-button custom-alert-close">&times;</span>
            <p id="customAlertMessage"></p>
            <div class="custom-alert-buttons">
                <button id="customAlertConfirm" class="btn primary custom-alert-btn confirm-btn" style="display:none;"></button>
                <button id="customAlertCancel" class="btn secondary custom-alert-btn cancel-btn" style="display:none;"></button>
                <button id="customAlertOk" class="btn primary custom-alert-btn ok-btn" style="display:none;">OK</button>
            </div>
        </div>
    </div>

    <script>
        // A Firebase konfiguráció most is itt van, de később ezt kell áthelyezni
        const firebaseConfig = {
            apiKey: "AIzaSyDGgG3y0ppl4639bzjzKA7Yq8BmSkhR-LU",
            authDomain: "munkaido-3cc44.firebaseapp.com",
            projectId: "munkaido-3cc44",
            storageBucket: "munkaido-3cc44.appspot.com",
            messagingSenderId: "338902507851",
            appId: "1:338902507851:web:753177f1548fb9073e51f0"
        };
        firebase.initializeApp(firebaseConfig);
    </script>
    <script src="./script.js"></script>
</body>
</html>